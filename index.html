<<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Excel Quiz Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
        
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        h1 {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.8rem;
            margin-bottom: 10px;
        }
        
        .tagline {
            color: var(--gray);
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .category-tags {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .category-tag {
            background: var(--light);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--dark);
            border: 1px solid #dee2e6;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
        }
        
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .upload-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .quick-start {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            height: fit-content;
        }
        
        .upload-area {
            border: 3px dashed var(--primary);
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            margin: 20px 0;
            background: rgba(67, 97, 238, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        .upload-area:hover::before {
            left: 100%;
        }
        
        .upload-area:hover {
            border-color: var(--secondary);
            background: rgba(67, 97, 238, 0.1);
            transform: translateY(-5px);
        }
        
        .upload-icon {
            font-size: 60px;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #f8961e, #f3722c);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #f72585, #b5179e);
            color: white;
        }
        
        .format-guide {
            background: rgba(248, 249, 250, 0.9);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border-left: 5px solid var(--primary);
        }
        
        .format-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .format-table th, .format-table td {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: left;
        }
        
        .format-table th {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        .format-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .quiz-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            display: none;
        }
        
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .quiz-info {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .quiz-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .progress-container {
            flex-grow: 1;
            margin: 0 30px;
        }
        
        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 5px;
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .question-container {
            margin-bottom: 40px;
        }
        
        .question-text {
            font-size: 1.4rem;
            margin-bottom: 30px;
            line-height: 1.6;
            color: var(--dark);
            padding: 25px;
            background: var(--light);
            border-radius: 15px;
            border-left: 5px solid var(--primary);
        }
        
        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
        }
        
        .option {
            padding: 20px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            background: white;
        }
        
        .option:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .option.selected {
            background: rgba(67, 97, 238, 0.1);
            border-color: var(--primary);
            box-shadow: 0 5px 20px rgba(67, 97, 238, 0.2);
        }
        
        .option.correct {
            background: rgba(76, 201, 240, 0.1);
            border-color: #4cc9f0;
        }
        
        .option.incorrect {
            background: rgba(247, 37, 133, 0.1);
            border-color: #f72585;
        }
        
        .option-label {
            width: 45px;
            height: 45px;
            min-width: 45px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--dark);
            transition: all 0.3s ease;
        }
        
        .option.selected .option-label {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .option-content {
            font-size: 1.1rem;
            line-height: 1.5;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }
        
        .nav-btn {
            padding: 14px 35px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 160px;
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .results-container {
            text-align: center;
            padding: 50px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            display: none;
        }
        
        .score-circle {
            width: 220px;
            height: 220px;
            margin: 30px auto;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 3.2rem;
            font-weight: bold;
            box-shadow: 0 15px 35px rgba(67, 97, 238, 0.3);
            animation: pulse 2s infinite;
            position: relative;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .score-circle::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border-radius: 50%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            z-index: -1;
        }
        
        .status {
            margin: 20px 0;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            animation: slideDown 0.3s ease;
        }
        
        .status-success {
            background: rgba(76, 201, 240, 0.1);
            color: #4cc9f0;
            border: 1px solid rgba(76, 201, 240, 0.3);
        }
        
        .status-error {
            background: rgba(247, 37, 133, 0.1);
            color: #f72585;
            border: 1px solid rgba(247, 37, 133, 0.3);
        }
        
        .status-info {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            border: 1px solid rgba(67, 97, 238, 0.3);
        }
        
        .quick-start-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .quick-btn {
            padding: 20px 15px;
            background: var(--light);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .quick-btn:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .quick-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid #e9ecef;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .timer {
            background: linear-gradient(45deg, #f8961e, #f3722c);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .review-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e9ecef;
            text-align: left;
        }
        
        .review-item {
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            background: var(--light);
            border-left: 4px solid transparent;
        }
        
        .review-item.correct {
            border-left-color: #4cc9f0;
            background: rgba(76, 201, 240, 0.05);
        }
        
        .review-item.incorrect {
            border-left-color: #f72585;
            background: rgba(247, 37, 133, 0.05);
        }
        
        .file-name {
            margin-top: 15px;
            color: var(--gray);
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            display: inline-block;
            border: 1px solid #dee2e6;
        }
        
        .hidden {
            display: none;
        }
        
        .quiz-category {
            display: inline-block;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
        }
    </style>
    <!-- Include SheetJS library for Excel support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-file-excel"></i>  Quiz Platform</h1>
            <p class="tagline">Create and take quizzes from any Excel file </p>
            <div class="category-tags">
                <span class="category-tag">AI & Machine Learning</span>
                <span class="category-tag">Science</span>
                <span class="category-tag">Mathematics</span>
                <span class="category-tag">History</span>
                <span class="category-tag">Geography</span>
                <span class="category-tag">Programming</span>
                <span class="category-tag">General Knowledge</span>
            </div>
        </div>

        <div class="main-content">
            <div class="upload-section" id="upload-section">
                <h2><i class="fas fa-cloud-upload-alt"></i> Upload Your Quiz File</h2>
                <p>Supports any quiz category: AI, Science, Math, History, Programming, etc.</p>
                
                <div class="upload-area" onclick="document.getElementById('excel-file').click()">
                    <div class="upload-icon">
                        <i class="fas fa-file-excel"></i>
                    </div>
                    <h3>üìÅ Drag & Drop or Click to Upload</h3>
                    <p>Supported formats: .xlsx, .xls, .csv</p>
                    <input type="file" id="excel-file" class="file-input" accept=".xlsx,.xls,.csv">
                    <button class="btn btn-primary" style="margin-top: 20px;">
                        <i class="fas fa-upload"></i> Choose Excel File
                    </button>
                    <div id="selected-file" class="file-name"></div>
                </div>
                
                <div class="format-guide">
                    <h3><i class="fas fa-info-circle"></i> Flexible Excel Format</h3>
                    <p>Your Excel file can have these formats:</p>
                    
                    <h4>Format 1: Basic (6 columns)</h4>
                    <table class="format-table">
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Option A</th>
                                <th>Option B</th>
                                <th>Option C</th>
                                <th>Option D</th>
                                <th>Answer</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>What is 2+2?</td>
                                <td>3</td>
                                <td>4</td>
                                <td>5</td>
                                <td>6</td>
                                <td>B</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <h4>Format 2: With Question Numbers (7 columns)</h4>
                    <table class="format-table">
                        <thead>
                            <tr>
                                <th>Q.No</th>
                                <th>Question</th>
                                <th>Option A</th>
                                <th>Option B</th>
                                <th>Option C</th>
                                <th>Option D</th>
                                <th>Answer</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>Capital of France?</td>
                                <td>London</td>
                                <td>Berlin</td>
                                <td>Paris</td>
                                <td>Madrid</td>
                                <td>C</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="status status-info">
                        <i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Answer column accepts A, B, C, D (uppercase or lowercase)
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-quizzes">0</div>
                        <div class="stat-label">Quizzes Taken</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-questions">0</div>
                        <div class="stat-label">Questions Answered</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg-score">0%</div>
                        <div class="stat-label">Average Score</div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="loadExcel()" style="width: 100%; padding: 18px; font-size: 1.1rem;">
                    <i class="fas fa-rocket"></i> üöÄ Load Questions & Start Quiz
                </button>
                
                <div id="upload-status" class="status"></div>
            </div>
            
            <div class="quick-start">
                <h2><i class="fas fa-bolt"></i> Quick Start</h2>
                <p>Try sample quizzes instantly or download templates:</p>
                
                <div class="quick-start-grid">
                    <div class="quick-btn" onclick="loadSampleQuiz('ai')">
                        <span class="quick-icon">ü§ñ</span>
                        <strong>AI Quiz</strong>
                        <p style="font-size: 0.9rem; color: var(--gray); margin-top: 5px;">5 Questions</p>
                    </div>
                    <div class="quick-btn" onclick="loadSampleQuiz('science')">
                        <span class="quick-icon">üî¨</span>
                        <strong>Science Quiz</strong>
                        <p style="font-size: 0.9rem; color: var(--gray); margin-top: 5px;">5 Questions</p>
                    </div>
                    <div class="quick-btn" onclick="loadSampleQuiz('math')">
                        <span class="quick-icon">üßÆ</span>
                        <strong>Math Quiz</strong>
                        <p style="font-size: 0.9rem; color: var(--gray); margin-top: 5px;">5 Questions</p>
                    </div>
                    <div class="quick-btn" onclick="loadSampleQuiz('history')">
                        <span class="quick-icon">üèõÔ∏è</span>
                        <strong>History Quiz</strong>
                        <p style="font-size: 0.9rem; color: var(--gray); margin-top: 5px;">5 Questions</p>
                    </div>
                </div>
                
                <h3 style="margin-top: 30px;"><i class="fas fa-download"></i> Download Templates</h3>
                <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-success" onclick="downloadTemplate('basic')">
                        <i class="fas fa-file-excel"></i> Basic Template (6 columns)
                    </button>
                    <button class="btn btn-success" onclick="downloadTemplate('numbered')">
                        <i class="fas fa-file-excel"></i> Numbered Template (7 columns)
                    </button>
                    <button class="btn btn-warning" onclick="downloadTemplate('all')">
                        <i class="fas fa-download"></i> All Sample Quizzes
                    </button>
                </div>
                
                <div class="status status-info" style="margin-top: 20px;">
                    <i class="fas fa-star"></i> <strong>Pro Tip:</strong> Create your own quizzes in Excel and upload them!
                </div>
            </div>
        </div>
        
        <div class="quiz-container" id="quiz-container">
            <div class="quiz-header">
                <div class="quiz-info">
                    <div>
                        <span class="quiz-title" id="quiz-title">Quiz</span>
                        <span class="quiz-category" id="quiz-category">General</span>
                    </div>
                    <div id="question-counter">Question: 1/0</div>
                    <div id="score-display">Score: 0</div>
                    <div class="timer" id="timer">
                        <i class="fas fa-clock"></i> <span id="time-display">00:00</span>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>
            </div>
            
            <div class="question-container">
                <div class="question-text" id="question-text"></div>
                <div class="options-container" id="options-container"></div>
            </div>
            
            <div class="navigation">
                <button id="prev-btn" class="nav-btn btn-primary" disabled>
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button id="next-btn" class="nav-btn btn-primary">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
                <button id="submit-btn" class="nav-btn btn-danger" style="display: none;">
                    <i class="fas fa-paper-plane"></i> Submit Quiz
                </button>
            </div>
        </div>
        
        <div class="results-container" id="results-container">
            <h2><i class="fas fa-trophy"></i> üéâ Quiz Completed!</h2>
            <p id="quiz-type-text" style="color: var(--gray); margin-bottom: 20px;"></p>
            
            <div class="score-circle" id="final-score-circle">
                <div id="final-score">0/0</div>
                <div id="percentage" style="font-size: 0.6em; opacity: 0.8;">0%</div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="correct-answers">0</div>
                    <div class="stat-label">Correct Answers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="time-taken">0:00</div>
                    <div class="stat-label">Time Taken</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="accuracy">0%</div>
                    <div class="stat-label">Accuracy</div>
                </div>
            </div>
            
            <div id="score-text" style="font-size: 1.2rem; margin: 20px 0; padding: 20px; background: var(--light); border-radius: 12px;"></div>
            
            <div class="review-section" id="review-section" style="display: none;">
                <h3><i class="fas fa-list-alt"></i> Question Review</h3>
                <div id="review-content"></div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showUploadSection()">
                    <i class="fas fa-redo"></i> Take Another Quiz
                </button>
                <button class="btn btn-success" onclick="showReview()">
                    <i class="fas fa-chart-bar"></i> Review Answers
                </button>
                <button class="btn btn-warning" onclick="shareResults()">
                    <i class="fas fa-share-alt"></i> Share Results
                </button>
                <button class="btn btn-danger" onclick="downloadResults()">
                    <i class="fas fa-download"></i> Download Results
                </button>
            </div>
        </div>
    </div>

    <script>
        // Universal Quiz Platform
        let quizData = [];
        let currentQuestion = 0;
        let score = 0;
        let userAnswers = [];
        let quizTime = 0;
        let timerInterval;
        let quizStarted = false;
        let quizCategory = 'General';
        let quizFileName = '';

        // DOM elements
        const uploadSection = document.getElementById('upload-section');
        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('results-container');
        const uploadStatus = document.getElementById('upload-status');
        const selectedFileDiv = document.getElementById('selected-file');

        // Initialize
        updateGlobalStats();
        setupDragAndDrop();

        // Setup drag and drop
        function setupDragAndDrop() {
            const uploadArea = document.querySelector('.upload-area');
            const fileInput = document.getElementById('excel-file');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = 'var(--secondary)';
                uploadArea.style.background = 'rgba(67, 97, 238, 0.15)';
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.borderColor = 'var(--primary)';
                uploadArea.style.background = 'rgba(67, 97, 238, 0.05)';
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = 'var(--primary)';
                uploadArea.style.background = 'rgba(67, 97, 238, 0.05)';
                
                const file = e.dataTransfer.files[0];
                if (file && (file.name.match(/\.(xlsx|xls|csv)$/i))) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelection(file);
                } else {
                    showStatus('Please drop an Excel file (.xlsx, .xls, .csv)', 'error');
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (fileInput.files[0]) {
                    handleFileSelection(fileInput.files[0]);
                }
            });
        }

        function handleFileSelection(file) {
            quizFileName = file.name;
            selectedFileDiv.innerHTML = `<i class="fas fa-file-excel"></i> Selected: <strong>${file.name}</strong>`;
            
            // Detect category from filename
            const lowerName = file.name.toLowerCase();
            if (lowerName.includes('ai') || lowerName.includes('machine')) quizCategory = 'AI';
            else if (lowerName.includes('science')) quizCategory = 'Science';
            else if (lowerName.includes('math')) quizCategory = 'Math';
            else if (lowerName.includes('history')) quizCategory = 'History';
            else if (lowerName.includes('geo')) quizCategory = 'Geography';
            else if (lowerName.includes('program') || lowerName.includes('code')) quizCategory = 'Programming';
            else if (lowerName.includes('gk')) quizCategory = 'General Knowledge';
            else quizCategory = 'Custom';
            
            showStatus(`${quizCategory} file selected. Click "Load Questions" to start!`, 'success');
        }

        // Show status messages
        function showStatus(message, type = 'info') {
            uploadStatus.textContent = message;
            uploadStatus.className = `status status-${type}`;
            setTimeout(() => {
                uploadStatus.style.opacity = '0';
                setTimeout(() => {
                    uploadStatus.textContent = '';
                    uploadStatus.className = 'status';
                    uploadStatus.style.opacity = '1';
                }, 300);
            }, 4000);
        }

        // Update global statistics
        function updateGlobalStats() {
            const stats = JSON.parse(localStorage.getItem('quizStats')) || {
                totalQuizzes: 0,
                totalQuestions: 0,
                totalScore: 0
            };
            
            document.getElementById('total-quizzes').textContent = stats.totalQuizzes;
            document.getElementById('total-questions').textContent = stats.totalQuestions.toLocaleString();
            document.getElementById('avg-score').textContent = stats.totalQuizzes > 0 
                ? Math.round((stats.totalScore / stats.totalQuizzes)) + '%' 
                : '0%';
        }

        // Save quiz statistics
        function saveQuizStats(finalScore, totalQuestions, category) {
            const stats = JSON.parse(localStorage.getItem('quizStats')) || {
                totalQuizzes: 0,
                totalQuestions: 0,
                totalScore: 0
            };
            
            stats.totalQuizzes++;
            stats.totalQuestions += totalQuestions;
            stats.totalScore += finalScore;
            
            // Save category stats
            const categoryStats = JSON.parse(localStorage.getItem('categoryStats')) || {};
            if (!categoryStats[category]) categoryStats[category] = { count: 0, totalScore: 0 };
            categoryStats[category].count++;
            categoryStats[category].totalScore += finalScore;
            
            localStorage.setItem('quizStats', JSON.stringify(stats));
            localStorage.setItem('categoryStats', JSON.stringify(categoryStats));
            updateGlobalStats();
        }

        // Download templates
        function downloadTemplate(type) {
            let sampleData;
            
            if (type === 'basic') {
                sampleData = [
                    ['Question', 'Option A', 'Option B', 'Option C', 'Option D', 'Answer'],
                    ['What is the capital of France?', 'London', 'Berlin', 'Paris', 'Madrid', 'C'],
                    ['What is 2+2?', '3', '4', '5', '6', 'B'],
                    ['Which planet is known as the Red Planet?', 'Earth', 'Mars', 'Jupiter', 'Venus', 'B']
                ];
                createExcelFile(sampleData, 'quiz_template_basic.xlsx');
            } else if (type === 'numbered') {
                sampleData = [
                    ['Q.No', 'Question', 'Option A', 'Option B', 'Option C', 'Option D', 'Answer'],
                    [1, 'What is the capital of France?', 'London', 'Berlin', 'Paris', 'Madrid', 'C'],
                    [2, 'What is 2+2?', '3', '4', '5', '6', 'B'],
                    [3, 'Which planet is known as the Red Planet?', 'Earth', 'Mars', 'Jupiter', 'Venus', 'B']
                ];
                createExcelFile(sampleData, 'quiz_template_numbered.xlsx');
            } else if (type === 'all') {
                // Create multiple sample files
                const categories = ['AI', 'Science', 'Math', 'History'];
                categories.forEach(cat => {
                    const data = getSampleData(cat);
                    createExcelFile(data, `sample_quiz_${cat.toLowerCase()}.xlsx`);
                });
                showStatus('All sample quizzes downloaded!', 'success');
                return;
            }
            
            showStatus('Template downloaded! Open it in Excel to add your questions.', 'success');
        }

        function createExcelFile(data, filename) {
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Questions");
            XLSX.writeFile(wb, filename);
        }

        // Load sample quizzes
        function loadSampleQuiz(category) {
            quizData = getSampleQuestions(category);
            quizCategory = category.charAt(0).toUpperCase() + category.slice(1);
            quizFileName = `Sample ${quizCategory} Quiz`;
            
            showStatus(`‚úÖ ${quizCategory} quiz loaded with ${quizData.length} questions!`, 'success');
            setTimeout(() => {
                startQuiz();
            }, 1000);
        }

        function getSampleQuestions(category) {
            const samples = {
                ai: [
                    {
                        question: "What is Artificial Intelligence?",
                        options: ["Programming computers", "Making machines intelligent", "Data storage technique", "Network security"],
                        correct: 1
                    },
                    {
                        question: "Which is a type of Machine Learning?",
                        options: ["Supervised Learning", "Manual Learning", "Human Learning", "Natural Learning"],
                        correct: 0
                    }
                ],
                science: [
                    {
                        question: "What is the chemical symbol for water?",
                        options: ["H2O", "CO2", "O2", "NaCl"],
                        correct: 0
                    },
                    {
                        question: "Which planet is known as the Red Planet?",
                        options: ["Earth", "Mars", "Jupiter", "Venus"],
                        correct: 1
                    }
                ],
                math: [
                    {
                        question: "What is 15 √ó 3?",
                        options: ["30", "45", "50", "35"],
                        correct: 1
                    },
                    {
                        question: "What is the value of œÄ (pi) to two decimal places?",
                        options: ["3.12", "3.14", "3.16", "3.18"],
                        correct: 1
                    }
                ],
                history: [
                    {
                        question: "Who was the first President of the United States?",
                        options: ["Thomas Jefferson", "Abraham Lincoln", "George Washington", "John Adams"],
                        correct: 2
                    },
                    {
                        question: "In which year did World War II end?",
                        options: ["1943", "1944", "1945", "1946"],
                        correct: 2
                    }
                ]
            };
            
            // Return 5 questions for each category
            const baseQuestions = samples[category] || samples['ai'];
            return [...baseQuestions, ...baseQuestions, ...baseQuestions.slice(0, 1)]; // 5 questions
        }

        function getSampleData(category) {
            const samples = {
                AI: [
                    ['Q.No', 'Question', 'Option A', 'Option B', 'Option C', 'Option D', 'Answer'],
                    [1, 'What is Artificial Intelligence?', 'Programming computers', 'Making machines intelligent', 'Data storage technique', 'Network security', 'B'],
                    [2, 'What does NLP stand for?', 'Natural Language Processing', 'Neural Learning Program', 'Network Logic Protocol', 'Natural Learning Process', 'A']
                ],
                Science: [
                    ['Q.No', 'Question', 'Option A', 'Option B', 'Option C', 'Option D', 'Answer'],
                    [1, 'What is H2O?', 'Water', 'Carbon Dioxide', 'Oxygen', 'Salt', 'A'],
                    [2, 'Which planet has rings?', 'Earth', 'Mars', 'Saturn', 'Venus', 'C']
                ],
                Math: [
                    ['Q.No', 'Question', 'Option A', 'Option B', 'Option C', 'Option D', 'Answer'],
                    [1, 'What is 7 √ó 8?', '54', '56', '58', '60', 'B'],
                    [2, 'What is ‚àö64?', '6', '7', '8', '9', 'C']
                ],
                History: [
                    ['Q.No', 'Question', 'Option A', 'Option B', 'Option C', 'Option D', 'Answer'],
                    [1, 'Who invented the telephone?', 'Thomas Edison', 'Alexander Graham Bell', 'Nikola Tesla', 'Albert Einstein', 'B'],
                    [2, 'When did WWII end?', '1943', '1944', '1945', '1946', 'C']
                ]
            };
            
            return samples[category] || samples['AI'];
        }

        // Load and parse Excel file
        function loadExcel() {
            const fileInput = document.getElementById('excel-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showStatus('Please select an Excel file first! Or try a sample quiz.', 'error');
                return;
            }

            showStatus('Reading Excel file...', 'info');
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    quizData = [];
                    
                    // Detect format (6 or 7 columns)
                    const firstRow = jsonData[0] || [];
                    const hasQNoColumn = firstRow[0] && firstRow[0].toString().toLowerCase().includes('q.no');
                    const startRow = hasQNoColumn ? 1 : 0;
                    const answerColIndex = hasQNoColumn ? 6 : 5;
                    
                    for (let i = startRow; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (!row || row.length < answerColIndex + 1) continue;
                        
                        let question, options, correctIndex;
                        
                        if (hasQNoColumn) {
                            // Format: Q.No, Question, A, B, C, D, Answer
                            question = row[1];
                            options = [row[2], row[3], row[4], row[5]];
                        } else {
                            // Format: Question, A, B, C, D, Answer
                            question = row[0];
                            options = [row[1], row[2], row[3], row[4]];
                        }
                        
                        const answer = row[answerColIndex];
                        if (!question || !answer) continue;
                        
                        // Parse answer (A, B, C, D or 1, 2, 3, 4)
                        const answerStr = answer.toString().trim().toUpperCase();
                        if (answerStr === 'A' || answerStr === '1') correctIndex = 0;
                        else if (answerStr === 'B' || answerStr === '2') correctIndex = 1;
                        else if (answerStr === 'C' || answerStr === '3') correctIndex = 2;
                        else if (answerStr === 'D' || answerStr === '4') correctIndex = 3;
                        else continue;
                        
                        // Ensure all options have values
                        const validOptions = options.map(opt => opt ? opt.toString().trim() : '');
                        
                        quizData.push({
                            question: question.toString().trim(),
                            options: validOptions,
                            correct: correctIndex
                        });
                    }
                    
                    if (quizData.length > 0) {
                        showStatus(`‚úÖ Successfully loaded ${quizData.length} questions!`, 'success');
                        setTimeout(() => {
                            startQuiz();
                        }, 1000);
                    } else {
                        showStatus('‚ùå No valid questions found. Please check your Excel format.', 'error');
                    }
                    
                } catch (error) {
                    showStatus('‚ùå Error reading Excel file: ' + error.message, 'error');
                    console.error('Excel parsing error:', error);
                }
            };
            
            reader.onerror = function() {
                showStatus('‚ùå Error reading the file. Please try again.', 'error');
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Start the quiz
        function startQuiz() {
            if (quizData.length === 0) {
                showStatus('No questions loaded.', 'error');
                return;
            }
            
            uploadSection.style.display = 'none';
            quizContainer.style.display = 'block';
            resultsContainer.style.display = 'none';
            
            currentQuestion = 0;
            score = 0;
            userAnswers = new Array(quizData.length).fill(null);
            quizTime = 0;
            quizStarted = true;
            
            // Update quiz title
            document.getElementById('quiz-title').textContent = quizFileName;
            document.getElementById('quiz-category').textContent = quizCategory;
            
            startTimer();
            showQuestion();
        }

        // Timer functions
        function startTimer() {
            clearInterval(timerInterval);
            quizTime = 0;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                quizTime++;
                updateTimerDisplay();
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(quizTime / 60);
            const seconds = quizTime % 60;
            document.getElementById('time-display').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Show current question
        function showQuestion() {
            const question = quizData[currentQuestion];
            
            document.getElementById('question-text').textContent = `${currentQuestion + 1}. ${question.question}`;
            document.getElementById('question-counter').textContent = `Question: ${currentQuestion + 1}/${quizData.length}`;
            document.getElementById('score-display').textContent = `Score: ${score}`;
            
            // Update progress bar
            const progress = ((currentQuestion + 1) / quizData.length) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                if (!option) return;
                
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                
                if (userAnswers[currentQuestion] === index) {
                    optionElement.classList.add('selected');
                }
                
                optionElement.innerHTML = `
                    <span class="option-label">${String.fromCharCode(65 + index)}</span>
                    <span class="option-content">${option}</span>
                `;
                
                optionElement.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('prev-btn').disabled = currentQuestion === 0;
            
            if (currentQuestion === quizData.length - 1) {
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('submit-btn').style.display = 'inline-flex';
            } else {
                document.getElementById('next-btn').style.display = 'inline-flex';
                document.getElementById('submit-btn').style.display = 'none';
            }
        }

        // Select an option
        function selectOption(index) {
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            document.querySelectorAll('.option')[index].classList.add('selected');
            userAnswers[currentQuestion] = index;
            updateScore();
        }

        // Update score
        function updateScore() {
            let newScore = 0;
            for (let i = 0; i <= currentQuestion; i++) {
                if (userAnswers[i] === quizData[i].correct) {
                    newScore++;
                }
            }
            score = newScore;
            document.getElementById('score-display').textContent = `Score: ${score}`;
        }

        // Navigation button events
        document.getElementById('next-btn').onclick = function() {
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                showQuestion();
            }
        };

        document.getElementById('prev-btn').onclick = function() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            }
        };

        // Submit quiz
        document.getElementById('submit-btn').onclick = function() {
            clearInterval(timerInterval);
            
            let finalScoreValue = 0;
            for (let i = 0; i < quizData.length; i++) {
                if (userAnswers[i] === quizData[i].correct) {
                    finalScoreValue++;
                }
            }
            
            const percentage = Math.round((finalScoreValue / quizData.length) * 100);
            
            // Update results display
            document.getElementById('final-score').textContent = `${finalScoreValue}/${quizData.length}`;
            document.getElementById('percentage').textContent = `${percentage}%`;
            document.getElementById('correct-answers').textContent = finalScoreValue;
            document.getElementById('time-taken').textContent = document.getElementById('time-display').textContent;
            document.getElementById('accuracy').textContent = `${percentage}%`;
            document.getElementById('quiz-type-text').textContent = `${quizCategory} Quiz - ${quizFileName}`;
            
            // Set score message
            let message = '';
            if (percentage === 100) message = "üéØ Perfect score! Absolutely brilliant!";
            else if (percentage >= 90) message = "üèÜ Outstanding! You're a quiz master!";
            else if (percentage >= 80) message = "üåü Excellent performance!";
            else if (percentage >= 70) message = "üëç Very good! Solid understanding!";
            else if (percentage >= 60) message = "üìö Good effort! Keep learning!";
            else if (percentage >= 50) message = "üí° Decent score! Room for improvement!";
            else message = "üß† Keep practicing! You'll get better!";
            
            document.getElementById('score-text').textContent = message;
            
            // Show results
            quizContainer.style.display = 'none';
            resultsContainer.style.display = 'block';
            
            saveQuizStats(percentage, quizData.length, quizCategory);
        };

        // Show review of answers
        function showReview() {
            const reviewSection = document.getElementById('review-section');
            const reviewContent = document.getElementById('review-content');
            
            if (reviewSection.style.display === 'block') {
                reviewSection.style.display = 'none';
                return;
            }
            
            let reviewHTML = '';
            quizData.forEach((q, i) => {
                const userAnswer = userAnswers[i];
                const isCorrect = userAnswer === q.correct;
                const userAnswerText = userAnswer !== null ? q.options[userAnswer] : 'Not answered';
                const correctAnswerText = q.options[q.correct];
                const optionLetter = String.fromCharCode(65 + q.correct);
                
                reviewHTML += `
                    <div class="review-item ${isCorrect ? 'correct' : 'incorrect'}">
                        <p><strong>Q${i+1}:</strong> ${q.question}</p>
                        <p>Your answer: ${userAnswerText} ${isCorrect ? '‚úÖ' : '‚ùå'}</p>
                        <p>Correct answer: ${correctAnswerText} (${optionLetter})</p>
                    </div>
                `;
            });
            
            reviewContent.innerHTML = reviewHTML;
            reviewSection.style.display = 'block';
        }

        // Share results
        function shareResults() {
            const score = document.getElementById('final-score').textContent;
            const percentage = document.getElementById('percentage').textContent;
            const time = document.getElementById('time-taken').textContent;
            
            const text = `I scored ${score} (${percentage}) in ${time} on the ${quizCategory} Quiz! Test your knowledge at ${window.location.href}`;
            
            if (navigator.share) {
                navigator.share({
                    title: `${quizCategory} Quiz Results`,
                    text: text,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    showStatus('Results copied to clipboard!', 'success');
                });
            }
        }

        // Download results
        function downloadResults() {
            const resultsData = [
                ['Quiz Results', '', '', ''],
                ['Quiz Category:', quizCategory, '', ''],
                ['Quiz File:', quizFileName, '', ''],
                ['Date:', new Date().toLocaleDateString(), '', ''],
                ['', '', '', ''],
                ['Total Questions:', quizData.length, '', ''],
                ['Correct Answers:', score, '', ''],
                ['Score:', `${score}/${quizData.length}`, '', ''],
                ['Percentage:', `${Math.round((score / quizData.length) * 100)}%`, '', ''],
                ['Time Taken:', document.getElementById('time-display').textContent, '', ''],
                ['', '', '', ''],
                ['Question Review', 'Your Answer', 'Correct Answer', 'Status']
            ];
            
            quizData.forEach((q, i) => {
                const userAnswer = userAnswers[i];
                const isCorrect = userAnswer === q.correct;
                const userAnswerText = userAnswer !== null ? q.options[userAnswer] : 'Not answered';
                const correctAnswerText = q.options[q.correct];
                
                resultsData.push([
                    `Q${i+1}: ${q.question}`,
                    userAnswerText,
                    correctAnswerText,
                    isCorrect ? 'Correct' : 'Incorrect'
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(resultsData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Quiz Results");
            XLSX.writeFile(wb, `quiz_results_${quizCategory}_${Date.now()}.xlsx`);
            showStatus('Results downloaded as Excel file!', 'success');
        }

        // Show upload section again
        function showUploadSection() {
            uploadSection.style.display = 'block';
            quizContainer.style.display = 'none';
            resultsContainer.style.display = 'none';
            uploadStatus.textContent = '';
            selectedFileDiv.textContent = '';
            document.getElementById('excel-file').value = '';
            clearInterval(timerInterval);
            quizStarted = false;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (!quizStarted) return;
            
            switch(e.key) {
                case 'ArrowRight':
                    if (currentQuestion < quizData.length - 1) {
                        document.getElementById('next-btn').click();
                    }
                    break;
                case 'ArrowLeft':
                    if (currentQuestion > 0) {
                        document.getElementById('prev-btn').click();
                    }
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                    const index = parseInt(e.key) - 1;
                    if (index < quizData[currentQuestion].options.length) {
                        selectOption(index);
                    }
                    break;
                case 'Enter':
                    if (currentQuestion === quizData.length - 1) {
                        document.getElementById('submit-btn').click();
                    } else {
                        document.getElementById('next-btn').click();
                    }
                    break;
            }
        });
    </script>
</body>
</html>